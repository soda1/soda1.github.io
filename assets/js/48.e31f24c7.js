(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{408:function(t,e,a){"use strict";a.r(e);var s=a(4),l=Object(s.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h5",{attrs:{id:"作用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#作用"}},[t._v("#")]),t._v(" 作用")]),t._v(" "),e("p",[t._v("记录更改数据/数据库的日志，一般用于主从库同步或数据恢复")]),t._v(" "),e("h5",{attrs:{id:"开启数据日志"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开启数据日志"}},[t._v("#")]),t._v(" 开启数据日志")]),t._v(" "),e("p",[t._v("在my.cnf增加配置，有好几种方式，这种比较简单")]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开启binlog日志")]),t._v("\nlog-bin "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /usr/local/mysql/mysql-5.7.24/data/mysql-bin\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置serverid")]),t._v("\nserver-id "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置日志过期时间")]),t._v("\nexpire_logs_days "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置每个binlog文件大小")]),t._v("\nmax_binlog_size "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 100m\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#binlog缓存大小")]),t._v("\nbinlog_cache_size "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 4m\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#最大binlog缓存大小")]),t._v("\nmax_binlog_cache_size "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 40m\n\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br")])]),e("h5",{attrs:{id:"相关变量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#相关变量"}},[t._v("#")]),t._v(" 相关变量")]),t._v(" "),e("ol",[e("li",[e("p",[e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html#sysvar_binlog_format",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("binlog_format")]),e("OutboundLink")],1)]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("Command-Line Format")]),t._v(" "),e("th",[e("code",[t._v("--binlog-format=format")])])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("System Variable")]),t._v(" "),e("td",[e("code",[t._v("binlog_format")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Scope")]),t._v(" "),e("td",[t._v("Global, Session")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Dynamic")]),t._v(" "),e("td",[t._v("Yes")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Type")]),t._v(" "),e("td",[t._v("Enumeration")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Default Value")]),t._v(" "),e("td",[e("code",[t._v("ROW")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Valid Values")]),t._v(" "),e("td",[e("code",[t._v("MIXED``STATEMENT``ROW")])])])])]),t._v(" "),e("p",[t._v("binlog记录格式，binlog格式为statement。会出现数据与日志不一致情况，比如sql中用了随机函数（UUID()），那么到从库中数据会出现不一致情况。具体阅读https://dev.mysql.com/doc/refman/8.0/en/replication-sbr-rbr.html")])]),t._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html#sysvar_expire_logs_days",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("expire_logs_days")]),e("OutboundLink")],1)]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("Command-Line Format")]),t._v(" "),e("th",[e("code",[t._v("--expire-logs-days=#")])])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("System Variable")]),t._v(" "),e("td",[e("code",[t._v("expire_logs_days")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Scope")]),t._v(" "),e("td",[t._v("Global")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Dynamic")]),t._v(" "),e("td",[t._v("Yes")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Type")]),t._v(" "),e("td",[t._v("Integer")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Default Value")]),t._v(" "),e("td",[e("code",[t._v("0")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Minimum Value")]),t._v(" "),e("td",[e("code",[t._v("0")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Maximum Value")]),t._v(" "),e("td",[e("code",[t._v("99")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Unit")]),t._v(" "),e("td",[t._v("days")])])])])]),t._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html#sysvar_log_bin",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("log_bin")]),e("OutboundLink")],1)]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("System Variable")]),t._v(" "),e("th",[e("code",[t._v("log_bin")])])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Scope")]),t._v(" "),e("td",[t._v("Global")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Dynamic")]),t._v(" "),e("td",[t._v("No")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Type")]),t._v(" "),e("td",[t._v("Boolean")])])])])]),t._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html#sysvar_log_bin_basename",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("log_bin_basename")]),e("OutboundLink")],1)]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("System Variable")]),t._v(" "),e("th",[e("code",[t._v("log_bin_basename")])])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Scope")]),t._v(" "),e("td",[t._v("Global")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Dynamic")]),t._v(" "),e("td",[t._v("No")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Type")]),t._v(" "),e("td",[t._v("File name")])])])])])]),t._v(" "),e("h5",{attrs:{id:"日志查看"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#日志查看"}},[t._v("#")]),t._v(" 日志查看")]),t._v(" "),e("ol",[e("li",[t._v("mysql查看binlog")])]),t._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("show binlog events;  #只查看第一个binlog文件的内容\nshow binlog events in mysql-bin.000002;#查看指定binlog文件的内容\nshow binary logs; #获取binlog文件列表\nshow master status； #查看当前正在写入的binlog文件\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[e("p",[t._v("使用mysqlbinlog工具")]),t._v(" "),e("p",[t._v("一般的"),e("code",[t._v("statement")]),t._v("格式的二进制文件，用下面命令就可以")]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("mysqlbinlog mysql-bin.000001\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("如果是"),e("code",[t._v("row")]),t._v("格式，加上"),e("code",[t._v("-v")]),t._v("或者"),e("code",[t._v("-vv")]),t._v("参数就行，如")]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("mysqlbinlog "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-vv")]),t._v(" --start-position"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("458")]),t._v(" mysql-bin.000001\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])])])])])}),[],!1,null,null,null);e.default=l.exports}}]);